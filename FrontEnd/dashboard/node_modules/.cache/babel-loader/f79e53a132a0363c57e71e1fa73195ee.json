{"ast":null,"code":"/*\r\nTHIS INFRAGISTICS ULTIMATE SOFTWARE LICENSE  AGREEMENT (\"AGREEMENT\") LOCATED HERE:\r\nhttps://www.infragistics.com/legal/license/igultimate-la\r\nhttps://www.infragistics.com/legal/license/igultimate-eula\r\nGOVERNS THE LICENSING, INSTALLATION AND USE OF INFRAGISTICS SOFTWARE. BY DOWNLOADING AND/OR INSTALLING AND USING INFRAGISTICS SOFTWARE:  you are indicating that you have read and understand this Agreement, and agree to be legally bound by it on behalf of the yourself and your company.\r\n*/\nimport * as tslib_1 from \"tslib\";\nimport { Base, runOn, typeCast, markType } from \"./type\";\nimport { AsyncDataSourcePageRequest } from \"./AsyncDataSourcePageRequest\";\nimport { WeakReference } from \"./WeakReference\";\nimport { IDataSourceExecutionContext_$type } from \"./IDataSourceExecutionContext\";\nimport { LinkedList$1 } from \"./LinkedList$1\";\nimport { List$1 } from \"./List$1\";\n/**\r\n * @hidden\r\n */\n\nvar AsyncVirtualDataSourceProviderWorker =\n/** @class */\n\n/*@__PURE__*/\nfunction (_super) {\n  tslib_1.__extends(AsyncVirtualDataSourceProviderWorker, _super);\n\n  function AsyncVirtualDataSourceProviderWorker(a) {\n    var _this = _super.call(this) || this;\n\n    _this.r = new LinkedList$1(AsyncDataSourcePageRequest.$);\n    _this.p = new List$1(AsyncDataSourcePageRequest.$, 0);\n    _this.ac = {};\n    _this.i = true;\n    _this.u = 0;\n    _this.t = 0;\n    _this.v = 0;\n    _this.e = null;\n    _this.s = -1;\n    _this.as = null;\n    _this.aq = null;\n    _this.ar = null;\n    _this.h = false;\n    _this._isShutdown = false;\n    _this.g = false;\n    _this.i = true;\n    _this.u = a.pageSizeRequested;\n    _this.t = _this.u;\n    _this.v = a.timeoutMilliseconds;\n    _this.as = new WeakReference(a.pageLoaded);\n    _this.aq = new WeakReference(a.batchCompleted);\n    _this.ar = new WeakReference(a.executionContext);\n    return _this;\n  }\n\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"tasks\", {\n    get: function () {\n      return this.p;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"pageLoaded\", {\n    get: function () {\n      if (this.as == null) {\n        return null;\n      }\n\n      return this.as.c;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"batchCompleted\", {\n    get: function () {\n      if (this.aq == null) {\n        return null;\n      }\n\n      return this.aq.c;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"executionContext\", {\n    get: function () {\n      if (this.ar == null) {\n        return null;\n      }\n\n      return this.ar.c;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"actualPageSize\", {\n    get: function () {\n      return this.t;\n    },\n    set: function (a) {\n      this.t = a;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"actualCount\", {\n    get: function () {\n      return this.s;\n    },\n    set: function (a) {\n      this.s = a;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"actualSchema\", {\n    get: function () {\n      return this.e;\n    },\n    set: function (a) {\n      this.e = a;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"populatedActualPageSize\", {\n    get: function () {\n      return this.h;\n    },\n    set: function (a) {\n      this.h = a;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"isRunning\", {\n    get: function () {\n      return this.i;\n    },\n    set: function (a) {\n      this.i = a;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  AsyncVirtualDataSourceProviderWorker.prototype.addPageRequest = function (a, b) {\n    return this.addPageRequestWithRetry(a, b, 200);\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.addPageRequestWithRetry = function (a, b, c) {\n    if (this.isShutdown) {\n      return false;\n    }\n\n    if (b == 2) {\n      this.r.e(new AsyncDataSourcePageRequest(a, c));\n    } else {\n      this.r.f(new AsyncDataSourcePageRequest(a, c));\n    }\n\n    return true;\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.removePageRequest = function (a) {\n    var b = null;\n    var c = this.r.c;\n\n    while (c != null) {\n      var d = c.c;\n\n      if (d.index == a) {\n        b = c;\n        break;\n      }\n\n      c = c.a;\n    }\n\n    if (b != null) {\n      this.r.h(b);\n    }\n  };\n\n  Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"isShutdown\", {\n    get: function () {\n      return this._isShutdown;\n    },\n    set: function (a) {\n      this._isShutdown = a;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  AsyncVirtualDataSourceProviderWorker.prototype.removeAllPageRequests = function () {\n    this.r.g();\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.shutdown = function () {\n    this.as = null;\n    this.aq = null;\n    this.ar = null;\n    this.isShutdown = true;\n    this.i = false;\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.initialize = function () {};\n\n  AsyncVirtualDataSourceProviderWorker.prototype.getTaskDataHolder = function () {\n    return null;\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.getTasksData = function (a) {};\n\n  AsyncVirtualDataSourceProviderWorker.prototype.removeCompletedTaskData = function (a, b) {};\n\n  AsyncVirtualDataSourceProviderWorker.prototype.getCompletedTaskData = function (a, b) {};\n\n  AsyncVirtualDataSourceProviderWorker.prototype.runATask = function () {\n    for (var a = 0; a < this.p.count; a++) {\n      if (!this.p.item(a).taskHolder.task.isRunning && !this.p.item(a).isDone && !this.p.item(a).taskHolder.task.isCompleted && !this.p.item(a).taskHolder.task.isCancelled) {\n        this.p.item(a).taskHolder.task.isRunning = true;\n        this.p.item(a).taskHolder.task.run();\n        break;\n      }\n    }\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.checkAndPotentiallyWaitOnTasks = function (a) {\n    this.runATask();\n\n    for (var b = 0; b < a.length; b++) {\n      if (a[b].isDone || a[b].taskHolder.task.isCompleted || a[b].taskHolder.task.isCancelled) {\n        return b;\n      }\n    }\n\n    return -1;\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.doWork = function () {\n    if (!this.g) {\n      this.g = true;\n      this.initialize();\n    }\n\n    {\n      var a = null;\n      var b = null;\n      var c = this.p.count;\n\n      if (this.r.c != null && c < 2) {\n        var d = this.r.c;\n        this.r.i();\n        this.makeTaskForRequest(d.c, d.c.retryDelay);\n        c = this.p.count;\n      }\n\n      if (c > 0) {\n        a = new Array(c);\n\n        for (var e = 0; e < c; e++) {\n          a[e] = this.p.item(e);\n        }\n\n        b = this.getTaskDataHolder();\n        this.getTasksData(b);\n      }\n\n      if (a != null && a.length > 0) {\n        var f = this.checkAndPotentiallyWaitOnTasks(a);\n\n        if (!this.i) {\n          return;\n        }\n\n        if (f >= 0) {\n          var g = a[f];\n          this.getCompletedTaskData(b, f);\n          this.p.remove(g);\n          this.removeCompletedTaskData(b, f);\n          this.processCompletedTask(g.taskHolder, g.retryDelay, g.index, b);\n        }\n      } else {}\n\n      if (!this.i) {\n        return;\n      }\n\n      if (this.i) {\n        window.setTimeout(runOn(this, this.doWork), 100);\n      }\n    }\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.makeTaskForRequest = function (a, b) {};\n\n  AsyncVirtualDataSourceProviderWorker.prototype.processCompletedTask = function (a, b, c, d) {};\n\n  AsyncVirtualDataSourceProviderWorker.prototype.retryIndex = function (a, b) {\n    var _this = this;\n\n    var c = b * 2;\n\n    if (b > 20000) {\n      this.removePageRequest(a);\n    }\n\n    if (this.ar == null) {\n      this.shutdown();\n      return;\n    }\n\n    var d = typeCast(IDataSourceExecutionContext_$type, this.ar.c);\n\n    if (d == null) {\n      this.shutdown();\n      return;\n    }\n\n    d.executeDelayed(function () {\n      return _this.addPageRequestWithRetry(a, 0, c);\n    }, b);\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.isLastPage = function (a) {\n    if (this.s < 0) {\n      return false;\n    }\n\n    if (this.s - a * this.t < this.t) {\n      return true;\n    }\n\n    return false;\n  };\n\n  AsyncVirtualDataSourceProviderWorker.prototype.createBatchRequest = function (a) {};\n\n  AsyncVirtualDataSourceProviderWorker.$t = markType(AsyncVirtualDataSourceProviderWorker, 'AsyncVirtualDataSourceProviderWorker');\n  AsyncVirtualDataSourceProviderWorker.maxSimultaneousExecutingTasks = 2;\n  AsyncVirtualDataSourceProviderWorker.maxRetryDelay = 20000;\n  AsyncVirtualDataSourceProviderWorker.initialRetryDelay = 200;\n  return AsyncVirtualDataSourceProviderWorker;\n}(Base);\n\nexport { AsyncVirtualDataSourceProviderWorker };","map":{"version":3,"sources":["../../../../src/igniteui-core/lib/AsyncVirtualDataSourceProviderWorker.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\r\nTHIS INFRAGISTICS ULTIMATE SOFTWARE LICENSE  AGREEMENT (\"AGREEMENT\") LOCATED HERE:\r\nhttps://www.infragistics.com/legal/license/igultimate-la\r\nhttps://www.infragistics.com/legal/license/igultimate-eula\r\nGOVERNS THE LICENSING, INSTALLATION AND USE OF INFRAGISTICS SOFTWARE. BY DOWNLOADING AND/OR INSTALLING AND USING INFRAGISTICS SOFTWARE:  you are indicating that you have read and understand this Agreement, and agree to be legally bound by it on behalf of the yourself and your company.\r\n*/\r\nimport * as tslib_1 from \"tslib\";\r\nimport { Base, runOn, typeCast, markType } from \"./type\";\r\nimport { AsyncDataSourcePageRequest } from \"./AsyncDataSourcePageRequest\";\r\nimport { WeakReference } from \"./WeakReference\";\r\nimport { IDataSourceExecutionContext_$type } from \"./IDataSourceExecutionContext\";\r\nimport { LinkedList$1 } from \"./LinkedList$1\";\r\nimport { List$1 } from \"./List$1\";\r\n/**\r\n * @hidden\r\n */\r\nvar AsyncVirtualDataSourceProviderWorker = /** @class */ /*@__PURE__*/ (function (_super) {\r\n    tslib_1.__extends(AsyncVirtualDataSourceProviderWorker, _super);\r\n    function AsyncVirtualDataSourceProviderWorker(a) {\r\n        var _this = _super.call(this) || this;\r\n        _this.r = new LinkedList$1(AsyncDataSourcePageRequest.$);\r\n        _this.p = new List$1(AsyncDataSourcePageRequest.$, 0);\r\n        _this.ac = {};\r\n        _this.i = true;\r\n        _this.u = 0;\r\n        _this.t = 0;\r\n        _this.v = 0;\r\n        _this.e = null;\r\n        _this.s = -1;\r\n        _this.as = null;\r\n        _this.aq = null;\r\n        _this.ar = null;\r\n        _this.h = false;\r\n        _this._isShutdown = false;\r\n        _this.g = false;\r\n        _this.i = true;\r\n        _this.u = a.pageSizeRequested;\r\n        _this.t = _this.u;\r\n        _this.v = a.timeoutMilliseconds;\r\n        _this.as = new WeakReference(a.pageLoaded);\r\n        _this.aq = new WeakReference(a.batchCompleted);\r\n        _this.ar = new WeakReference(a.executionContext);\r\n        return _this;\r\n    }\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"tasks\", {\r\n        get: function () {\r\n            return this.p;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"pageLoaded\", {\r\n        get: function () {\r\n            if (this.as == null) {\r\n                return null;\r\n            }\r\n            return this.as.c;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"batchCompleted\", {\r\n        get: function () {\r\n            if (this.aq == null) {\r\n                return null;\r\n            }\r\n            return this.aq.c;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"executionContext\", {\r\n        get: function () {\r\n            if (this.ar == null) {\r\n                return null;\r\n            }\r\n            return this.ar.c;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"actualPageSize\", {\r\n        get: function () {\r\n            return this.t;\r\n        },\r\n        set: function (a) {\r\n            this.t = a;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"actualCount\", {\r\n        get: function () {\r\n            return this.s;\r\n        },\r\n        set: function (a) {\r\n            this.s = a;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"actualSchema\", {\r\n        get: function () {\r\n            return this.e;\r\n        },\r\n        set: function (a) {\r\n            this.e = a;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"populatedActualPageSize\", {\r\n        get: function () {\r\n            return this.h;\r\n        },\r\n        set: function (a) {\r\n            this.h = a;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"isRunning\", {\r\n        get: function () {\r\n            return this.i;\r\n        },\r\n        set: function (a) {\r\n            this.i = a;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AsyncVirtualDataSourceProviderWorker.prototype.addPageRequest = function (a, b) {\r\n        return this.addPageRequestWithRetry(a, b, 200);\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.addPageRequestWithRetry = function (a, b, c) {\r\n        if (this.isShutdown) {\r\n            return false;\r\n        }\r\n        if (b == 2) {\r\n            this.r.e(new AsyncDataSourcePageRequest(a, c));\r\n        }\r\n        else {\r\n            this.r.f(new AsyncDataSourcePageRequest(a, c));\r\n        }\r\n        return true;\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.removePageRequest = function (a) {\r\n        var b = null;\r\n        var c = this.r.c;\r\n        while (c != null) {\r\n            var d = c.c;\r\n            if (d.index == a) {\r\n                b = c;\r\n                break;\r\n            }\r\n            c = c.a;\r\n        }\r\n        if (b != null) {\r\n            this.r.h(b);\r\n        }\r\n    };\r\n    Object.defineProperty(AsyncVirtualDataSourceProviderWorker.prototype, \"isShutdown\", {\r\n        get: function () {\r\n            return this._isShutdown;\r\n        },\r\n        set: function (a) {\r\n            this._isShutdown = a;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AsyncVirtualDataSourceProviderWorker.prototype.removeAllPageRequests = function () {\r\n        this.r.g();\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.shutdown = function () {\r\n        this.as = null;\r\n        this.aq = null;\r\n        this.ar = null;\r\n        this.isShutdown = true;\r\n        this.i = false;\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.initialize = function () {\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.getTaskDataHolder = function () {\r\n        return null;\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.getTasksData = function (a) {\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.removeCompletedTaskData = function (a, b) {\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.getCompletedTaskData = function (a, b) {\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.runATask = function () {\r\n        for (var a = 0; a < this.p.count; a++) {\r\n            if (!this.p.item(a).taskHolder.task.isRunning && !this.p.item(a).isDone && !this.p.item(a).taskHolder.task.isCompleted && !this.p.item(a).taskHolder.task.isCancelled) {\r\n                this.p.item(a).taskHolder.task.isRunning = true;\r\n                this.p.item(a).taskHolder.task.run();\r\n                break;\r\n            }\r\n        }\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.checkAndPotentiallyWaitOnTasks = function (a) {\r\n        this.runATask();\r\n        for (var b = 0; b < a.length; b++) {\r\n            if (a[b].isDone || a[b].taskHolder.task.isCompleted || a[b].taskHolder.task.isCancelled) {\r\n                return b;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.doWork = function () {\r\n        if (!this.g) {\r\n            this.g = true;\r\n            this.initialize();\r\n        }\r\n        {\r\n            var a = null;\r\n            var b = null;\r\n            var c = this.p.count;\r\n            if (this.r.c != null && c < 2) {\r\n                var d = this.r.c;\r\n                this.r.i();\r\n                this.makeTaskForRequest(d.c, d.c.retryDelay);\r\n                c = this.p.count;\r\n            }\r\n            if (c > 0) {\r\n                a = new Array(c);\r\n                for (var e = 0; e < c; e++) {\r\n                    a[e] = this.p.item(e);\r\n                }\r\n                b = this.getTaskDataHolder();\r\n                this.getTasksData(b);\r\n            }\r\n            if (a != null && a.length > 0) {\r\n                var f = this.checkAndPotentiallyWaitOnTasks(a);\r\n                if (!this.i) {\r\n                    return;\r\n                }\r\n                if (f >= 0) {\r\n                    var g = a[f];\r\n                    this.getCompletedTaskData(b, f);\r\n                    this.p.remove(g);\r\n                    this.removeCompletedTaskData(b, f);\r\n                    this.processCompletedTask(g.taskHolder, g.retryDelay, g.index, b);\r\n                }\r\n            }\r\n            else {\r\n            }\r\n            if (!this.i) {\r\n                return;\r\n            }\r\n            if (this.i) {\r\n                window.setTimeout(runOn(this, this.doWork), 100);\r\n            }\r\n        }\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.makeTaskForRequest = function (a, b) {\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.processCompletedTask = function (a, b, c, d) {\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.retryIndex = function (a, b) {\r\n        var _this = this;\r\n        var c = b * 2;\r\n        if (b > 20000) {\r\n            this.removePageRequest(a);\r\n        }\r\n        if (this.ar == null) {\r\n            this.shutdown();\r\n            return;\r\n        }\r\n        var d = typeCast(IDataSourceExecutionContext_$type, this.ar.c);\r\n        if (d == null) {\r\n            this.shutdown();\r\n            return;\r\n        }\r\n        d.executeDelayed(function () { return _this.addPageRequestWithRetry(a, 0, c); }, b);\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.isLastPage = function (a) {\r\n        if (this.s < 0) {\r\n            return false;\r\n        }\r\n        if ((this.s - (a * this.t)) < this.t) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.prototype.createBatchRequest = function (a) {\r\n    };\r\n    AsyncVirtualDataSourceProviderWorker.$t = markType(AsyncVirtualDataSourceProviderWorker, 'AsyncVirtualDataSourceProviderWorker');\r\n    AsyncVirtualDataSourceProviderWorker.maxSimultaneousExecutingTasks = 2;\r\n    AsyncVirtualDataSourceProviderWorker.maxRetryDelay = 20000;\r\n    AsyncVirtualDataSourceProviderWorker.initialRetryDelay = 200;\r\n    return AsyncVirtualDataSourceProviderWorker;\r\n}(Base));\r\nexport { AsyncVirtualDataSourceProviderWorker };\r\n//# sourceMappingURL=AsyncVirtualDataSourceProviderWorker.js.map\r\n"]},"metadata":{},"sourceType":"module"}