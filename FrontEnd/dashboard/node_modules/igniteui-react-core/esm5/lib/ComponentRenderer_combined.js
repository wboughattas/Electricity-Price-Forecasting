/*
THIS INFRAGISTICS ULTIMATE SOFTWARE LICENSE  AGREEMENT ("AGREEMENT") LOCATED HERE:
https://www.infragistics.com/legal/license/igultimate-la
https://www.infragistics.com/legal/license/igultimate-eula
GOVERNS THE LICENSING, INSTALLATION AND USE OF INFRAGISTICS SOFTWARE. BY DOWNLOADING AND/OR INSTALLING AND USING INFRAGISTICS SOFTWARE:  you are indicating that you have read and understand this Agreement, and agree to be legally bound by it on behalf of the yourself and your company.
*/
import * as tslib_1 from "tslib";
import { Base, IEnumerable_$type, fromEnum, typeCast, Date_$type, Boolean_$type, Array_$type, String_$type, runOn, Delegate_$type, markType, Number_$type } from "./type";
import { TypeDescriptionContext } from "./TypeDescriptionContext";
import { TypeDescriptionPropretyTransforms } from "./TypeDescriptionPropretyTransforms";
import { TypeDescriptionCleanups } from "./TypeDescriptionCleanups";
import { Dictionary$2 } from "./Dictionary$2";
import { Description } from "./Description";
import { DescriptionTreeNode } from "./DescriptionTreeNode";
import { Queue$1 } from "./Queue$1";
import { DescriptionTreeAction } from "./DescriptionTreeAction";
import { DescriptionRef } from "./DescriptionRef";
import { List$1 } from "./List$1";
import { DescriptionSerializerBuilder } from "./DescriptionSerializerBuilder";
import { DescriptionSerializer } from "./DescriptionSerializer";
import { DataSourceLocalDataProvider } from "./DataSourceLocalDataProvider";
import { JsonDictionaryParser } from "./JsonDictionaryParser";
import { DescriptionTreeBuilder } from "./DescriptionTreeBuilder";
import { JsonDictionaryObject } from "./JsonDictionaryObject";
import { JsonDictionaryValue } from "./JsonDictionaryValue";
import { JsonDictionaryArray } from "./JsonDictionaryArray";
import { DescriptionTreeReconciler } from "./DescriptionTreeReconciler";
import { HashSet$1 } from "./HashSet$1";
import { NotImplementedException } from "./NotImplementedException";
import { ComponentRendererAdapter } from "./ComponentRendererAdapter";
import { stringIsNullOrEmpty, stringStartsWith } from "./string";
/**
 * @hidden
 */
var ComponentRenderer = /** @class */ /*@__PURE__*/ (function (_super) {
    tslib_1.__extends(ComponentRenderer, _super);
    function ComponentRenderer() {
        var _this = _super.call(this) || this;
        _this.d = null;
        _this._context = null;
        _this.i = null;
        _this.f = null;
        _this.aj = new Dictionary$2(Base.$, Description.$, 0);
        _this.ak = new Dictionary$2(Base.$, Boolean_$type, 0);
        _this.al = new Dictionary$2(Base.$, Boolean_$type, 0);
        _this.ai = new Dictionary$2(Base.$, Boolean_$type, 0);
        _this.ah = new Dictionary$2(Base.$, DescriptionTreeNode.$, 0);
        _this.ao = new Dictionary$2(Base.$, ContainerState.$, 0);
        _this.am = new Dictionary$2(Base.$, Queue$1.$.specialize(Queue$1.$.specialize(DescriptionTreeAction.$)), 0);
        _this.ag = new Dictionary$2(Base.$, Boolean_$type, 0);
        _this.an = new Dictionary$2(String_$type, DescriptionRef.$, 0);
        _this.ap = new Dictionary$2(String_$type, Base.$, 0);
        _this.ar = new Dictionary$2(String_$type, Base.$, 0);
        _this.aq = new Dictionary$2(String_$type, List$1.$.specialize(Delegate_$type), 0);
        _this.as = new List$1(Delegate_$type, 0);
        _this.at = new List$1(Delegate_$type, 0);
        _this._shouldNamespaceSystemRefValues = false;
        var a = _this.e();
        _this.d = a;
        _this.context = new TypeDescriptionContext(a, ComponentRenderer.platform);
        _this.i = new TypeDescriptionPropretyTransforms();
        _this.f = new TypeDescriptionCleanups();
        return _this;
    }
    Object.defineProperty(ComponentRenderer.prototype, "context", {
        get: function () {
            return this._context;
        },
        set: function (a) {
            this._context = a;
        },
        enumerable: true,
        configurable: true
    });
    ComponentRenderer.prototype.e = function () {
        return (new ComponentRendererAdapter());
    };
    ComponentRenderer.prototype.toJson = function (a) {
        var e_1, _a, e_2, _b;
        var b = new DescriptionSerializerBuilder();
        var c = new DescriptionSerializer();
        b.f("{");
        b.i();
        b.f("\"descriptions\": {");
        b.i();
        var d = true;
        try {
            for (var _c = tslib_1.__values(fromEnum(this.ah.keys)), _d = _c.next(); !_d.done; _d = _c.next()) {
                var e = _d.value;
                if (d) {
                    d = false;
                }
                else {
                    b.f(",");
                }
                var f = e;
                var g = this.ah.item(e);
                var h = "root";
                h = a(f);
                if (stringIsNullOrEmpty(h)) {
                    h = "root";
                }
                b.e("\"" + h + "\"");
                b.e(": ");
                c.o(this.context, g, b);
            }
        }
        catch (e_1_1) {
            e_1 = { error: e_1_1 };
        }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return))
                    _a.call(_c);
            }
            finally {
                if (e_1)
                    throw e_1.error;
            }
        }
        b.f("");
        b.h();
        b.e("}");
        if (this.ar.count > 0) {
            b.e(",");
        }
        b.f("");
        if (this.ar.count > 0) {
            d = true;
            b.f("refs: {");
            b.i();
            try {
                for (var _e = tslib_1.__values(fromEnum(this.ar.keys)), _f = _e.next(); !_f.done; _f = _e.next()) {
                    var i = _f.value;
                    if (!this.k(i, this.ar.item(i))) {
                        continue;
                    }
                    if (d) {
                        d = false;
                    }
                    else {
                        b.f(",");
                    }
                    this.ck(b, i, this.ar.item(i));
                }
            }
            catch (e_2_1) {
                e_2 = { error: e_2_1 };
            }
            finally {
                try {
                    if (_f && !_f.done && (_b = _e.return))
                        _b.call(_e);
                }
                finally {
                    if (e_2)
                        throw e_2.error;
                }
            }
            b.f("");
            b.h();
            b.f("}");
        }
        b.h();
        b.f("}");
        return b.toString();
    };
    ComponentRenderer.prototype.ck = function (a, b, c) {
        a.e("\"" + b + "\": ");
        this.cl(a, c);
    };
    ComponentRenderer.prototype.cl = function (a, b) {
        if (this.s(b)) {
            if (typeof b === 'string') {
                a.e(b == null ? "null" : "\"" + b.toString() + "\"");
            }
            else if (typeof b === 'number') {
                a.e(b == null ? "null" : b.toString());
            }
            else if (typeof b === 'number') {
                a.e(b == null ? "null" : b.toString());
            }
            else if (typeof b === 'number') {
                a.e(b == null ? "null" : b.toString());
            }
            else if (typeof b === 'number') {
                a.e(b == null ? "null" : b.toString());
            }
            else if (typeof b === 'number') {
                a.e(b == null ? "null" : b.toString());
            }
            else if (typeof b === 'number') {
                a.e(b == null ? "null" : b.toString());
            }
            else if (typeof b === 'number') {
                a.e(b == null ? "null" : b.toString());
            }
            else if (typeCast(Date_$type, b) !== null) {
                var v_ = b;
                a.e("\"" + (v_.toJSON()) + "\"");
            }
            else if (typeCast(Boolean_$type, b) !== null) {
                a.e(b == null ? "null" : b.toString().toLowerCase());
            }
            else {
                a.e("null");
            }
        }
        else {
            if (b == null) {
                a.e("null");
                return;
            }
            if (this.q(b)) {
                a.f("[");
                a.i();
                var c = new DataSourceLocalDataProvider();
                c.dataSource = b;
                for (var d = 0; d < c.actualCount; d++) {
                    if (d > 0) {
                        a.f(",");
                    }
                    this.cj(a, c, d);
                }
                a.f("");
                a.h();
                a.e("]");
            }
            else {
                var e = [b];
                var f = new DataSourceLocalDataProvider();
                f.dataSource = e;
                this.cj(a, f, 0);
            }
        }
    };
    ComponentRenderer.prototype.s = function (a) {
        if (typeof a === 'string') {
            return true;
        }
        if (typeof a === 'number' || typeof a === 'number' || typeof a === 'number' || typeof a === 'number' || typeof a === 'number' || typeof a === 'number' || typeof a === 'number') {
            return true;
        }
        if (typeCast(Date_$type, a) !== null) {
            return true;
        }
        if (typeCast(Boolean_$type, a) !== null) {
            return true;
        }
        return false;
    };
    ComponentRenderer.prototype.q = function (a) {
        if (typeCast(Array_$type, a) !== null) {
            return true;
        }
        if (typeCast(IEnumerable_$type, a) !== null) {
            return true;
        }
        return false;
    };
    ComponentRenderer.prototype.cj = function (a, b, c) {
        a.f("{");
        a.i();
        var d = b.actualSchema;
        for (var e = 0; e < d.propertyNames.length; e++) {
            if (e > 0) {
                a.f(",");
            }
            var f = d.propertyNames[e];
            if (stringStartsWith(f, "[")) {
                f = f.substr(1, f.length - 2);
            }
            a.e("\"" + f + "\"");
            a.e(": ");
            var g = b.getItemValue(b.getItemAtIndex(c), d.propertyNames[e]);
            switch (d.propertyTypes[e]) {
                case 0:
                    a.e(g == null ? "null" : "\"" + g.toString() + "\"");
                    break;
                case 2:
                    a.e(g == null ? "null" : "\"" + g.toString() + "\"");
                    break;
                case 10:
                case 6:
                case 5:
                case 1:
                case 3:
                case 4:
                case 7:
                    a.e(g == null ? "null" : g.toString());
                    break;
                case 8:
                    var v_ = g;
                    a.e("\"" + (v_.toJSON()) + "\"");
                    break;
                case 11:
                    this.cl(a, g);
                    break;
            }
        }
        a.h();
        a.f("}");
    };
    ComponentRenderer.prototype.k = function (a, b) {
        if (b == null) {
            return true;
        }
        var v_ = b;
        if ((typeof v_ === 'function')) {
            return false;
        }
        return true;
    };
    ComponentRenderer.prototype.createObjectFromJson = function (a, b) {
        var c = new JsonDictionaryParser();
        var d = c.parse(a);
        var e = new DescriptionSerializer();
        var f = false;
        var g = e.d(this.context, d, f);
        if (g.result == null) {
            return null;
        }
        var h = DescriptionTreeBuilder.createTree(this.context, g.result);
        var i = this.ao.item(b);
        if (h.b("Type")) {
            var j = h.a("Type").b;
            return this.bd(j, h, b, i, true, -1);
        }
        else {
            return this.bc(typeCast(JsonDictionaryObject.$, d));
        }
    };
    ComponentRenderer.prototype.loadJson = function (a, b) {
        this.b1(a, b, false, false);
    };
    ComponentRenderer.prototype.loadJsonDelta = function (a, b, c) {
        this.b1(a, b, true, c);
    };
    ComponentRenderer.prototype.b1 = function (a, b, c, d) {
        var e = new JsonDictionaryParser();
        var f = e.parse(a);
        var g = new DescriptionSerializer();
        var h = null;
        if (typeCast(JsonDictionaryObject.$, f) !== null) {
            var i = f;
            if (i.c("descriptions")) {
                var j = i.item("descriptions");
                if (typeCast(JsonDictionaryObject.$, j) !== null) {
                    var k = j;
                    var l = k.a();
                    for (var m = 0; m < l.length; m++) {
                        var n = l[m];
                        var o = k.item(n);
                        var p = b(n);
                        if (p == null) {
                            continue;
                        }
                        h = p;
                        var q = false;
                        var r = g.d(this.context, o, q);
                        if (r.result == null) {
                            continue;
                        }
                        this.cg(r.result, p, c, d, false);
                    }
                }
            }
            if (i.c("refs") && h != null) {
                var s = i.item("refs");
                if (typeCast(JsonDictionaryObject.$, s) !== null) {
                    var t = s;
                    var u = t.a();
                    for (var v = 0; v < u.length; v++) {
                        var w = u[v];
                        var x = t.item(w);
                        if (typeCast(JsonDictionaryValue.$, x) !== null) {
                            var y = x;
                            this.provideRefValue(h, w, y.value);
                        }
                        else if (typeCast(JsonDictionaryArray.$, x) !== null) {
                            var z = x;
                            var aa = this.a(z);
                            this.provideRefValue(h, w, aa);
                        }
                        else {
                            var ab = this.bc(x);
                            this.provideRefValue(h, w, ab);
                        }
                    }
                }
            }
        }
    };
    ComponentRenderer.prototype.a = function (a) {
        var b = new Array(a.items.length);
        for (var c = 0; c < a.items.length; c++) {
            var d = this.bc(a.items[c]);
            b[c] = d;
        }
        return b;
    };
    ComponentRenderer.prototype.bc = function (a) {
        if (a == null) {
            return null;
        }
        var b = {};
        var dict_ = b;
        var c = a.a();
        for (var d = 0; d < c.length; d++) {
            var key_ = c[d];
            if (typeCast(JsonDictionaryObject.$, a.item(key_)) !== null) {
                var val_ = this.bc(a.item(key_));
                dict_[key_] = val_;
            }
            else if (typeCast(JsonDictionaryArray.$, a.item(key_)) !== null) {
                var val_ = this.a(a.item(key_));
                dict_[key_] = val_;
            }
            else {
                var val_ = a.item(key_).value;
                dict_[key_] = val_;
            }
        }
        return dict_;
    };
    ComponentRenderer.prototype.cleanup = function (a, b) {
        this.cg(null, a, false, false, b);
    };
    ComponentRenderer.prototype.render = function (a, b) {
        this.cg(a, b, false, false, false);
    };
    ComponentRenderer.prototype.cg = function (a, b, c, d, e) {
        var _this = this;
        if (!this.ao.containsKey(b)) {
            this.ao.item(b, new ContainerState());
            this.ao.item(b).i = b;
        }
        this.aj.item(b, a);
        this.ak.item(b, c);
        this.al.item(b, d);
        this.ai.item(b, e);
        this.b2(b, function () { return _this.ce(b); });
    };
    ComponentRenderer.prototype.b2 = function (a, b) {
        this.d.onUIThread(a, b);
    };
    ComponentRenderer.prototype.ce = function (a) {
        var e_3, _a, e_4, _b, e_5, _c;
        var _this = this;
        if (this.aj.containsKey(a)) {
            var b = this.ak.containsKey(a) ? this.ak.item(a) : false;
            var c = this.al.containsKey(a) ? this.al.item(a) : false;
            var d = this.aj.item(a);
            this.aj.removeItem(a);
            var e = DescriptionTreeBuilder.createTree(this.context, d);
            var f = null;
            if (this.ah.containsKey(a)) {
                f = this.ah.item(a);
            }
            var g = DescriptionTreeReconciler.c(f, e, b);
            if (c) {
                var h = DescriptionTreeReconciler.a(f, g);
                if (!this.ao.containsKey(a)) {
                    this.ao.addItem(a, ((function () {
                        var $ret = new ContainerState();
                        $ret.i = a;
                        return $ret;
                    })()));
                }
                var i_1 = this.ao.item(a);
                if (h.a.count > 0) {
                    try {
                        for (var _d = tslib_1.__values(fromEnum(h.a)), _e = _d.next(); !_e.done; _e = _d.next()) {
                            var j = _e.value;
                            if (i_1.a(j)) {
                                var k = i_1.j(j);
                                this.bx(a, k, i_1);
                            }
                        }
                    }
                    catch (e_3_1) {
                        e_3 = { error: e_3_1 };
                    }
                    finally {
                        try {
                            if (_e && !_e.done && (_a = _d.return))
                                _a.call(_d);
                        }
                        finally {
                            if (e_3)
                                throw e_3.error;
                        }
                    }
                }
                if (h.c.count > 0) {
                    try {
                        for (var _f = tslib_1.__values(fromEnum(h.c)), _g = _f.next(); !_g.done; _g = _f.next()) {
                            var l = _g.value;
                            var m = this.bi(a, i_1, l);
                            var n = this.d.getPropertyValue(m, l.i);
                            if (n != null) {
                                if (!i_1.b(n)) {
                                    var o = l.f;
                                    if (typeCast(DescriptionTreeNode.$, o) !== null) {
                                        var p = o.f;
                                        i_1.k(a, p, n, o, runOn(this, this.b6), l.b.f);
                                    }
                                }
                            }
                        }
                    }
                    catch (e_4_1) {
                        e_4 = { error: e_4_1 };
                    }
                    finally {
                        try {
                            if (_g && !_g.done && (_b = _f.return))
                                _b.call(_f);
                        }
                        finally {
                            if (e_4)
                                throw e_4.error;
                        }
                    }
                }
                if (h.b.count > 0) {
                    var _loop_1 = function (q) {
                        var r = q.b.a(q.i).b;
                        if (r == null) {
                            return "continue";
                        }
                        var s = new Dictionary$2(String_$type, DescriptionTreeNode.$, 0);
                        for (var t = 0; t < r.length; t++) {
                            var u = r[t];
                            if (typeCast(DescriptionTreeNode.$, u) !== null) {
                                var v = u;
                                if (v.b("Name")) {
                                    s.item(v.a("Name").b, v);
                                }
                            }
                        }
                        if (s.count == 0) {
                            return "continue";
                        }
                        var w = this_1.bi(a, i_1, q);
                        var x = this_1.d.getPropertyValue(w, q.i);
                        if (x != null) {
                            var y_1 = 0;
                            this_1.d.forPropertyValueItem(w, q.i, function (z) {
                                if (s.containsKey(_this.d.getPropertyValue(z, "Name").toString())) {
                                    if (!i_1.b(z)) {
                                        var aa = s.item(_this.d.getPropertyValue(z, "Name").toString());
                                        if (typeCast(DescriptionTreeNode.$, aa) !== null) {
                                            var ab = aa.f;
                                            i_1.k(a, ab, z, aa, runOn(_this, _this.b6), q.b.f);
                                        }
                                    }
                                }
                                y_1++;
                            });
                        }
                    };
                    var this_1 = this;
                    try {
                        for (var _h = tslib_1.__values(fromEnum(h.b)), _j = _h.next(); !_j.done; _j = _h.next()) {
                            var q = _j.value;
                            _loop_1(q);
                        }
                    }
                    catch (e_5_1) {
                        e_5 = { error: e_5_1 };
                    }
                    finally {
                        try {
                            if (_j && !_j.done && (_c = _h.return))
                                _c.call(_h);
                        }
                        finally {
                            if (e_5)
                                throw e_5.error;
                        }
                    }
                }
            }
            else {
                this.ah.item(a, e);
            }
            if (!c) {
                this.cf(a, g);
            }
            if (this.ai.item(a)) {
                this.cc(a);
                if (this.ao.containsKey(a)) {
                    this.ao.removeItem(a);
                }
            }
        }
    };
    ComponentRenderer.prototype.provideRefValue = function (a, b, c) {
        var _this = this;
        this.b2(a, function () {
            if (!_this.ao.containsKey(a)) {
                _this.ao.addItem(a, ((function () {
                    var $ret = new ContainerState();
                    $ret.i = a;
                    return $ret;
                })()));
            }
            var d = _this.ao.item(a);
            _this.b6(a, b, c, true);
        });
    };
    ComponentRenderer.prototype.removeRefValue = function (a, b) {
        var _this = this;
        this.b2(a, function () {
            if (!_this.ao.containsKey(a)) {
                _this.ao.addItem(a, ((function () {
                    var $ret = new ContainerState();
                    $ret.i = a;
                    return $ret;
                })()));
            }
            var c = _this.ao.item(a);
            _this.removeRefValueCore(a, b, true);
        });
    };
    ComponentRenderer.prototype.cc = function (a) {
        var e_6, _a;
        var b = this.ao.item(a);
        var c = new List$1(String_$type, 0);
        try {
            for (var _b = tslib_1.__values(fromEnum(this.an.keys)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var d = _c.value;
                if (this.an.item(d).b == 0) {
                    c.add(d);
                }
            }
        }
        catch (e_6_1) {
            e_6 = { error: e_6_1 };
        }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return))
                    _a.call(_b);
            }
            finally {
                if (e_6)
                    throw e_6.error;
            }
        }
        for (var e = 0; e < c.count; e++) {
            var f = this.shouldNamespaceSystemRefValues;
            this.shouldNamespaceSystemRefValues = false;
            this.removeRefValueCore(a, c._inner[e], this.ar.containsKey(c._inner[e]));
            this.shouldNamespaceSystemRefValues = f;
        }
    };
    ComponentRenderer.prototype.clearRefValues = function (a) {
        var _this = this;
        this.b2(a, function () {
            if (!_this.ao.containsKey(a)) {
                _this.ao.addItem(a, ((function () {
                    var $ret = new ContainerState();
                    $ret.i = a;
                    return $ret;
                })()));
            }
            var b = _this.ao.item(a);
            _this.clearUserRefValues();
        });
    };
    ComponentRenderer.prototype.cf = function (a, b) {
        var c = this.ao.item(a);
        this.b3(a, c, b);
    };
    ComponentRenderer.prototype.ci = function (a, b) {
        this.by(a, b, true);
    };
    ComponentRenderer.prototype.co = function (a, b) {
        this.by(a, b, false);
    };
    ComponentRenderer.prototype.by = function (a, b, c) {
        if (!c) {
            if (this.ag.containsKey(a) && this.ag.item(a)) {
                return;
            }
        }
        this.ag.item(a, true);
        var d = true;
        while (d && this.am.item(a).count > 0) {
            while (this.am.item(a).count > 0 && this.am.item(a).c().count < 1) {
                this.am.item(a).b();
            }
            if (this.am.item(a).count < 1) {
                break;
            }
            var e = this.am.item(a).c();
            while (e.count > 0) {
                var f = e.b();
                d = this.t(a, b, f);
                if (!d) {
                    break;
                }
            }
        }
        if (d) {
            this.ag.item(a, false);
        }
    };
    ComponentRenderer.prototype.b3 = function (a, b, c) {
        var d = new Queue$1(DescriptionTreeAction.$);
        for (var e = 0; e < c.count; e++) {
            d.g(c._inner[e]);
        }
        if (!this.am.containsKey(a)) {
            this.am.addItem(a, new Queue$1(Queue$1.$.specialize(DescriptionTreeAction.$)));
        }
        this.am.item(a).g(d);
        this.co(a, b);
    };
    ComponentRenderer.prototype.b4 = function (a, b, c) {
        for (var d = 0; d < c.count; d++) {
            this.t(a, b, c._inner[d]);
        }
    };
    ComponentRenderer.prototype.t = function (a, b, c) {
        switch (c.a) {
            case 5: return this.u(a, b, c);
            case 2: return this.v(a, b, c);
            case 4: return this.w(a, b, c);
            case 3: return this.x(a, b, c);
            case 1: return this.y(a, b, c);
            case 0: return this.z(a, b, c);
        }
        return true;
    };
    ComponentRenderer.prototype.z = function (a, b, c) {
        var d = this.bi(a, b, c);
        this.af(a, b, c, d);
        return true;
    };
    ComponentRenderer.prototype.af = function (a, b, c, d) {
        var e = this.bf(c, a, b);
        e = this.i.b(ComponentRenderer.platform, e, c);
        if (c.c != null && c.c.knownType == 9) {
            this.ad(a, b, c.h(ComponentRenderer.platform), c.c, e, d);
        }
        else {
            this.cm(a, b, c.h(ComponentRenderer.platform), e, c.g, d);
        }
        return true;
    };
    ComponentRenderer.prototype.ad = function (a, b, c, d, e, f) {
        var e_7, _a;
        if (this.aq.containsKey(c)) {
            try {
                for (var _b = tslib_1.__values(fromEnum(this.aq.item(c))), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var g = _c.value;
                    g(c, f, e);
                }
            }
            catch (e_7_1) {
                e_7 = { error: e_7_1 };
            }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return))
                        _a.call(_b);
                }
                finally {
                    if (e_7)
                        throw e_7.error;
                }
            }
        }
        this.d.setOrUpdateCollectionOnTarget(a, c, d, this.context, f, e);
        return true;
    };
    ComponentRenderer.prototype.bf = function (a, b, c) {
        if (a.c == null) {
            return a.f;
        }
        switch (a.c.knownType) {
            case 10: return this.aw(a, b, c);
            case 7: return this.ax(a);
            case 4: return this.ay(a);
            case 6: return this.az(a);
            case 9: return this.aw(a, b, c);
            case 5: return this.a0(a);
            case 16: return this.a1(a);
            case 20: return this.bj(a, c);
            case 15: return null;
            case 3: return this.a2(a);
            case 19: return this.bk(a, c);
            case 8: return this.a4(a, b, c);
            case 13: return null;
            case 18: return this.bl(a, c);
            case 1: return this.a5(a);
            case 11: return this.a6(a);
            case 14: return this.a7(a);
            case 12: return this.a8(a);
            case 2: return this.a9(a);
            case 21: return this.ba(a);
            case 17: return this.bb(a, b, c);
            case 0: return null;
        }
        return null;
    };
    ComponentRenderer.prototype.bb = function (a, b, c) {
        if (typeCast(DescriptionTreeNode.$, a.f) !== null) {
            var d = a.f;
            if (d.h == "EmbeddedRef") {
                return this.bd(d.h, a.f, b, c, false, a.b.f);
            }
        }
        return a.f;
    };
    ComponentRenderer.prototype.ba = function (a) {
        return a.f;
    };
    ComponentRenderer.prototype.a9 = function (a) {
        return a.f != null ? a.f.toString() : null;
    };
    ComponentRenderer.prototype.a8 = function (a) {
        var b = a.f;
        var width_ = b.width;
        var height_ = b.height;
        var c = { width: width_, height: height_ };
        return c;
    };
    ComponentRenderer.prototype.a7 = function (a) {
        var b = a.f;
        var top_ = b.top;
        var left_ = b.left;
        var width_ = b.width;
        var height_ = b.height;
        var c = { left: left_, top: top_, width: width_, height: height_ };
        return c;
    };
    ComponentRenderer.prototype.a6 = function (a) {
        var b = a.f;
        var x_ = b.x;
        var y_ = b.y;
        var c = { x: x_, y: y_ };
        return c;
    };
    ComponentRenderer.prototype.a5 = function (a) {
        if (a.f == null) {
            if (a.c != null && (a.c.specificType == "double" || a.c.specificType == "float")) {
                return NaN;
            }
            return 0;
        }
        return a.f;
    };
    ComponentRenderer.prototype.b = function (a, b) {
        if (this.an.containsKey(a)) {
            var c = this.an.item(a);
            return c;
        }
        var d = new DescriptionRef(a);
        this.an.addItem(a, d);
        return d;
    };
    ComponentRenderer.prototype.bl = function (a, b) {
        return a.f == null ? null : this.b(a.f, b);
    };
    ComponentRenderer.prototype.a4 = function (a, b, c) {
        var d = a.c.specificType;
        if (d == null) {
            d = a.c.specificExternalType;
        }
        if (typeCast(DescriptionTreeNode.$, a.f) !== null) {
            var e = a.f;
            if (e.b("Type")) {
                d = e.a("Type").b;
            }
        }
        var f = this.bd(d, a.f, b, c, false, a.b.f);
        return f;
    };
    ComponentRenderer.prototype.bk = function (a, b) {
        return a.f == null ? null : this.b(a.f, b);
    };
    ComponentRenderer.prototype.a2 = function (a) {
        return a.f;
    };
    ComponentRenderer.prototype.bj = function (a, b) {
        return a.f == null ? null : this.b(a.f, b);
    };
    ComponentRenderer.prototype.bn = function (a) {
        return a;
    };
    ComponentRenderer.prototype.a1 = function (a) {
        var b = a.f;
        if (b == null) {
            return null;
        }
        var c = new Array(b.length);
        for (var d = 0; d < b.length; d++) {
            c[d] = this.bn(b[d]);
        }
        return c;
    };
    ComponentRenderer.prototype.a0 = function (a) {
        return this.bn(a.f);
    };
    ComponentRenderer.prototype.az = function (a) {
        var b = a.f;
        if (b == null) {
            return null;
        }
        var c = new Array(b.length);
        for (var d = 0; d < b.length; d++) {
            c[d] = this.bm(b[d]);
        }
        return c;
    };
    ComponentRenderer.prototype.bm = function (a) {
        return a;
    };
    ComponentRenderer.prototype.ay = function (a) {
        return this.bm(a.f);
    };
    ComponentRenderer.prototype.ax = function (a) {
        return a.f;
    };
    ComponentRenderer.prototype.addPropertyUpdatingListener = function (a, b) {
        if (!this.aq.containsKey(a)) {
            this.aq.addItem(a, new List$1(Delegate_$type, 0));
        }
        this.aq.item(a).add(b);
    };
    ComponentRenderer.prototype.addReferenceLookupListener = function (a) {
        this.as.add(a);
    };
    ComponentRenderer.prototype.removePropertyUpdatingListener = function (a, b) {
        if (this.aq.containsKey(a)) {
            this.aq.item(a).remove(b);
            if (this.aq.item(a).count == 0) {
                this.aq.removeItem(a);
            }
        }
    };
    ComponentRenderer.prototype.addNamespaceLookupListener = function (a) {
        this.at.add(a);
    };
    ComponentRenderer.prototype.removeNamespaceLookupListener = function (a) {
        this.at.remove(a);
    };
    ComponentRenderer.prototype.aw = function (a, b, c) {
        if (a.f == null) {
            return null;
        }
        var d = a.f;
        var e = new List$1(Base.$, 0);
        var f = a.c.specificType;
        if (f == null) {
            f = a.c.specificExternalType;
        }
        if (a.c.knownType == 9) {
            f = a.c.collectionElementType;
            if (f == null) {
                f = a.c.specificExternalType;
            }
        }
        for (var g = 0; g < d.length; g++) {
            var h = f;
            if (typeCast(DescriptionTreeNode.$, d[g]) !== null) {
                var i = d[g];
                if (i.b("Type")) {
                    h = i.a("Type").b;
                }
            }
            var j = this.bd(h, d[g], b, c, false, a.b.f);
            e.add1(j);
        }
        return e.toArray();
    };
    ComponentRenderer.prototype.cm = function (a, b, c, d, e, f) {
        var _this = this;
        if (typeCast(DescriptionRef.$, d) !== null) {
            var g = d;
            var h = false;
            if (e != null && typeof e === 'string') {
                if (this.n(e)) {
                    var i = this.c(e);
                    if (Base.equalsStatic(i, d)) {
                        h = true;
                    }
                    else {
                        i.i(a, f, c);
                    }
                }
            }
            if (this.o(d)) {
                d = this.bh(d);
                this.cn(f, c, d, e);
            }
            var j = null;
            j = function (k, l) {
                var m = _this.bh(k);
                _this.cn(f, c, m, e);
            };
            if (!h) {
                g.f(a, f, c, j);
            }
            return;
        }
        this.cn(f, c, d, e);
    };
    ComponentRenderer.prototype.hasUserRef = function (a) {
        return this.ar.containsKey(a);
    };
    Object.defineProperty(ComponentRenderer.prototype, "shouldNamespaceSystemRefValues", {
        get: function () {
            return this._shouldNamespaceSystemRefValues;
        },
        set: function (a) {
            this._shouldNamespaceSystemRefValues = a;
        },
        enumerable: true,
        configurable: true
    });
    ComponentRenderer.prototype.b6 = function (a, b, c, d) {
        var e = null;
        if (d) {
            if (this.ar.containsKey(b)) {
                e = this.ar.item(b);
            }
            this.ar.item(b, c);
        }
        else {
            if (this.shouldNamespaceSystemRefValues) {
                var f = "";
                if (this.at != null && this.at.count > 0) {
                    for (var g = 0; g < this.at.count; g++) {
                        f = this.at._inner[g](a);
                    }
                }
                if (!stringIsNullOrEmpty(f)) {
                    b = f + "/" + b;
                }
            }
            if (this.ap.containsKey(b)) {
                e = this.ap.item(b);
            }
            this.ap.item(b, c);
        }
        if (this.an.containsKey(b)) {
            this.an.item(b).e(e, c);
        }
    };
    ComponentRenderer.prototype.removeRefValueCore = function (a, b, c) {
        var d = null;
        if (c) {
            if (this.ar.containsKey(b)) {
                d = this.ar.item(b);
            }
            this.ar.removeItem(b);
        }
        else {
            if (this.shouldNamespaceSystemRefValues) {
                var e = "";
                if (this.at != null && this.at.count > 0) {
                    for (var f = 0; f < this.at.count; f++) {
                        e = this.at._inner[f](a);
                    }
                }
                if (!stringIsNullOrEmpty(e)) {
                    b = e + "/" + b;
                }
            }
            if (this.ap.containsKey(b)) {
                d = this.ap.item(b);
            }
            this.ap.removeItem(b);
        }
        if (this.an.containsKey(b)) {
            this.an.item(b).e(d, this.bh(this.an.item(b)));
            if (this.an.item(b).b <= 0) {
                this.an.item(b).g();
                this.an.removeItem(b);
            }
        }
    };
    ComponentRenderer.prototype.clearUserRefValues = function () {
        var e_8, _a, e_9, _b;
        var a = new List$1(String_$type, 0);
        try {
            for (var _c = tslib_1.__values(fromEnum(this.ar.keys)), _d = _c.next(); !_d.done; _d = _c.next()) {
                var b = _d.value;
                a.add(b);
            }
        }
        catch (e_8_1) {
            e_8 = { error: e_8_1 };
        }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return))
                    _a.call(_c);
            }
            finally {
                if (e_8)
                    throw e_8.error;
            }
        }
        try {
            for (var _e = tslib_1.__values(fromEnum(a)), _f = _e.next(); !_f.done; _f = _e.next()) {
                var c = _f.value;
                this.removeRefValueCore(null, c, true);
            }
        }
        catch (e_9_1) {
            e_9 = { error: e_9_1 };
        }
        finally {
            try {
                if (_f && !_f.done && (_b = _e.return))
                    _b.call(_e);
            }
            finally {
                if (e_9)
                    throw e_9.error;
            }
        }
    };
    ComponentRenderer.prototype.o = function (a) {
        return this.ar.containsKey(a.d) || this.ap.containsKey(a.d);
    };
    ComponentRenderer.prototype.bh = function (a) {
        if (this.ar.containsKey(a.d)) {
            return this.ar.item(a.d);
        }
        if (this.ap.containsKey(a.d)) {
            return this.ap.item(a.d);
        }
        return null;
    };
    ComponentRenderer.prototype.n = function (a) {
        return this.an.containsKey(a);
    };
    ComponentRenderer.prototype.c = function (a) {
        return this.an.item(a);
    };
    ComponentRenderer.prototype.bi = function (a, b, c) {
        return b.j(c.b.f);
    };
    ComponentRenderer.prototype.y = function (a, b, c) {
        var d = this.bi(a, b, c);
        this.ac(a, b, c, d);
        return true;
    };
    ComponentRenderer.prototype.ac = function (a, b, c, d) {
        this.d.resetPropertyOnTarget(a, c.h(ComponentRenderer.platform), c.c, d);
        return true;
    };
    ComponentRenderer.prototype.x = function (a, b, c) {
        if (c.b == null) {
            return this.ab(a, b, c);
        }
        else {
            var d = this.bi(a, b, c);
            this.ch(a, b, c, d);
        }
        return true;
    };
    ComponentRenderer.prototype.ch = function (a, b, c, d) {
        var e = c.h(ComponentRenderer.platform);
        var f = this.bd(c.c.collectionElementType, c.f, a, b, false, c.b.f);
        this.d.replaceItemInCollection(e, c.c, d, c.d, f);
        if (c.g != null && typeCast(DescriptionTreeNode.$, c.g) !== null) {
            var g = c.g.f;
            if (g >= 0) {
                var h = b.j(g);
                if (h != null) {
                    this.bx(a, h, b);
                }
            }
        }
    };
    ComponentRenderer.prototype.ab = function (a, b, c) {
        var _this = this;
        var d = this.d.getRootObject(a);
        if (d != null) {
            this.bx(a, d, b);
        }
        if (!(typeCast(DescriptionTreeNode.$, c.f) !== null)) {
            throw new NotImplementedException(0);
        }
        var e = c.f;
        var f = false;
        this.d.replaceRootItem(a, e.h, this.context, function (g) {
            var h = _this.d.getRootObject(a);
            b.k(a, e.f, h, e, runOn(_this, _this.b6), -1);
            var i = _this.au(e);
            _this.b4(a, b, i);
            f = true;
            if (g) {
                _this.ci(a, b);
            }
        });
        return f;
    };
    ComponentRenderer.prototype.bx = function (a, b, c) {
        var e_10, _a;
        var d = this.av(a, b, c);
        try {
            for (var _b = tslib_1.__values(fromEnum(this.an.values)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var e = _c.value;
                e.h(b);
            }
        }
        catch (e_10_1) {
            e_10 = { error: e_10_1 };
        }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return))
                    _a.call(_b);
            }
            finally {
                if (e_10)
                    throw e_10.error;
            }
        }
        if (d != -1) {
            c.l(this, a, d, runOn(this, this.removeRefValueCore));
        }
        this.f.b(ComponentRenderer.platform, b);
    };
    ComponentRenderer.prototype.av = function (a, b, c) {
        return c.h(b);
    };
    ComponentRenderer.prototype.w = function (a, b, c) {
        if (c.b == null) {
            return this.aa(a, b, c);
        }
        else {
            var d = this.bi(a, b, c);
            this.b7(a, b, c, d);
        }
        return true;
    };
    ComponentRenderer.prototype.b7 = function (a, b, c, d) {
        var e = c.h(ComponentRenderer.platform);
        this.d.removeItemFromCollection(e, c.c, d, c.e);
        if (c.g != null && typeCast(DescriptionTreeNode.$, c.g) !== null) {
            var f = c.g.f;
            if (f >= 0) {
                var g = b.j(f);
                if (g != null) {
                    this.bx(a, g, b);
                }
            }
        }
    };
    ComponentRenderer.prototype.aa = function (a, b, c) {
        var _this = this;
        var d = this.d.getRootObject(a);
        if (d != null) {
            this.bx(a, d, b);
        }
        var e = false;
        this.d.removeRootItem(a, this.context, function (f) {
            e = true;
            if (f) {
                _this.ci(a, b);
            }
        });
        return e;
    };
    ComponentRenderer.prototype.v = function (a, b, c) {
        if (c.b == null) {
            return this.j(a, b, c);
        }
        else {
            var d = this.bi(a, b, c);
            this.bp(a, b, c, d);
        }
        return true;
    };
    ComponentRenderer.prototype.j = function (a, b, c) {
        var _this = this;
        if (!(typeCast(DescriptionTreeNode.$, c.f) !== null)) {
            throw new NotImplementedException(0);
        }
        var d = c.f;
        var e = false;
        this.d.replaceRootItem(a, d.h, this.context, function (f) {
            var g = _this.d.getRootObject(a);
            b.k(a, d.f, g, d, runOn(_this, _this.b6), -1);
            var h = _this.au(d);
            _this.b4(a, b, h);
            e = true;
            if (f) {
                _this.ci(a, b);
            }
        });
        return e;
    };
    ComponentRenderer.prototype.bp = function (a, b, c, d) {
        var e = c.h(ComponentRenderer.platform);
        var f = c.c.collectionElementType;
        if (typeCast(DescriptionTreeNode.$, c.f) !== null) {
            var g = c.f;
            if (g.b("Type")) {
                f = g.a("Type").b;
            }
        }
        var h = this.bd(f, c.f, a, b, false, c.b.f);
        this.d.addItemToCollection(e, c.c, d, c.d, h);
    };
    ComponentRenderer.prototype.bd = function (a, b, c, d, e, f) {
        if (this.r(a)) {
            return b;
        }
        var g = null;
        if (b != null && typeCast(DescriptionTreeNode.$, b) !== null) {
            var h = b;
            if (h.b("Name")) {
                var i = h.a("Name").b;
                if (!stringIsNullOrEmpty(i)) {
                    if (this.shouldNamespaceSystemRefValues) {
                        var j = "";
                        if (this.at != null && this.at.count > 0) {
                            for (var k = 0; k < this.at.count; k++) {
                                j = this.at._inner[k](c);
                            }
                        }
                        if (!stringIsNullOrEmpty(j)) {
                            i = j + "/" + i;
                        }
                    }
                    if (this.ap.containsKey(i)) {
                        var l = this.ap.item(i);
                        g = l;
                    }
                }
            }
            if (g == null) {
                g = this.context.j(a, c);
            }
        }
        else {
            g = this.context.j(a, c);
        }
        if (b == null) {
            return g;
        }
        if (typeCast(DescriptionTreeNode.$, b) !== null) {
            var m = b;
            if (m.h == "EmbeddedRef") {
                var n = "uuid";
                var o = null;
                for (var p = 0; p < m.e().count; p++) {
                    if (m.e()._inner[p].c == "RefType") {
                        n = m.e()._inner[p].b;
                    }
                    if (m.e()._inner[p].c == "Value") {
                        o = m.e()._inner[p].b;
                    }
                }
                if (o != null) {
                    for (var q = 0; q < this.as.count; q++) {
                        var r = this.as._inner[q](c, n, o);
                        if (r != null) {
                            return r;
                        }
                    }
                    return null;
                }
            }
            else {
                d.k(c, m.f, g, m, runOn(this, this.b6), f);
                var s = this.au(m);
                this.b4(c, d, s);
                if (e) {
                    d.l(this, c, m.f, runOn(this, this.removeRefValueCore));
                }
            }
        }
        if (typeof b === 'string' && a.toLowerCase() != "string") {
            return this.a3(a, b);
        }
        if (a == "object" || a == "Object") {
            return b;
        }
        return g;
    };
    ComponentRenderer.prototype.r = function (a) {
        return a == "int" || a == "Int32" || a == "short" || a == "Int16" || a == "double" || a == "Double" || a == "float" || a == "Float" || a == "Single" || a == "single" || a == "DateTime" || a == "decimal" || a == "Decimal" || a == "long" || a == "Int64" || a == "byte" || a == "bool" || a == "string" || a == "String";
    };
    ComponentRenderer.prototype.a3 = function (a, b) {
        return this.context.f(a, b);
    };
    ComponentRenderer.prototype.au = function (a) {
        var b = a.e();
        var c = new List$1(DescriptionTreeAction.$, 0);
        for (var d = 0; d < b.count; d++) {
            var e = new DescriptionTreeAction();
            e.a = 0;
            e.i = b._inner[d].c;
            e.c = b._inner[d].a;
            e.b = a;
            e.f = b._inner[d].b;
            c.add(e);
        }
        return c;
    };
    ComponentRenderer.prototype.u = function (a, b, c) {
        if (c.b == null) {
            return this.m(a, b, c);
        }
        else {
            var d = this.bi(a, b, c);
            this.bu(a, b, c, d);
        }
        return true;
    };
    ComponentRenderer.prototype.bu = function (a, b, c, d) {
        var e = c.h(ComponentRenderer.platform);
        this.d.clearCollection(d, e, c.c);
        if (c.g != null && typeCast(Array_$type, c.g) !== null) {
            var f = c.g;
            for (var g = 0; g < f.length; g++) {
                var h = f[g];
                if (h != null && typeCast(DescriptionTreeNode.$, h) !== null) {
                    var i = h.f;
                    if (i >= 0) {
                        var j = b.j(i);
                        if (j != null) {
                            this.bx(a, j, b);
                        }
                    }
                }
            }
        }
    };
    ComponentRenderer.prototype.cn = function (a, b, c, d) {
        var e_11, _a;
        if (this.aq.containsKey(b)) {
            try {
                for (var _b = tslib_1.__values(fromEnum(this.aq.item(b))), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var e = _c.value;
                    e(b, a, c);
                }
            }
            catch (e_11_1) {
                e_11 = { error: e_11_1 };
            }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return))
                        _a.call(_b);
                }
                finally {
                    if (e_11)
                        throw e_11.error;
                }
            }
        }
        this.d.setPropertyValue(a, b, c, d);
    };
    ComponentRenderer.prototype.bg = function (a, b) {
        return this.d.getPropertyValue(a, b);
    };
    ComponentRenderer.prototype.m = function (a, b, c) {
        return this.l(a, b);
    };
    ComponentRenderer.prototype.l = function (a, b) {
        var _this = this;
        var c = this.d.getRootObject(a);
        if (c != null) {
            this.bx(a, c, b);
        }
        var d = false;
        this.d.clearContainer(a, this.context, function (e) {
            d = true;
            if (e) {
                _this.ci(a, b);
            }
        });
        return d;
    };
    ComponentRenderer.$t = markType(ComponentRenderer, 'ComponentRenderer');
    ComponentRenderer.platform = 3;
    return ComponentRenderer;
}(Base));
export { ComponentRenderer };
/**
 * @hidden
 */
var ContainerState = /** @class */ /*@__PURE__*/ (function (_super) {
    tslib_1.__extends(ContainerState, _super);
    function ContainerState() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.i = null;
        _this.e = new Dictionary$2(Number_$type, Base.$, 0);
        _this.f = new Dictionary$2(Base.$, Number_$type, 0);
        _this.d = new Dictionary$2(Number_$type, String_$type, 0);
        _this.g = new Dictionary$2(Number_$type, HashSet$1.$.specialize(Number_$type), 0);
        _this.c = new Dictionary$2(Number_$type, List$1.$.specialize(Number_$type), 0);
        return _this;
    }
    ContainerState.prototype.k = function (a, b, c, d, e, f) {
        if (d.b("Name")) {
            this.d.item(b, d.a("Name").b);
            e(a, this.d.item(b), c, false);
        }
        this.e.item(b, c);
        this.f.item(c, b);
        if (!this.g.containsKey(b)) {
            this.g.item(b, new HashSet$1(Number_$type, 0));
        }
        this.g.item(b).add_1(f);
        if (f >= 0) {
            if (!this.c.containsKey(f)) {
                this.c.item(f, new List$1(Number_$type, 0));
            }
            this.c.item(f).add(b);
        }
    };
    ContainerState.prototype.a = function (a) {
        return this.e.containsKey(a);
    };
    ContainerState.prototype.b = function (a) {
        return this.f.containsKey(a);
    };
    ContainerState.prototype.j = function (a) {
        return this.e.item(a);
    };
    ContainerState.prototype.l = function (a, b, c, d) {
        if (this.c.containsKey(c)) {
            var e = this.c.item(c);
            for (var f = 0; f < e.count; f++) {
                if (!this.g.containsKey(e._inner[f]) || this.g.item(e._inner[f]).count < 1 || (this.g.item(e._inner[f]).count == 1 && this.g.item(e._inner[f]).contains(c))) {
                    if (this.e.containsKey(e._inner[f])) {
                        a.bx(b, this.e.item(e._inner[f]), this);
                    }
                }
            }
            this.c.removeItem(c);
        }
        var g = this.e.item(c);
        this.f.removeItem(g);
        this.e.removeItem(c);
        if (this.g.containsKey(c)) {
            this.g.removeItem(c);
        }
        if (this.d.containsKey(c)) {
            var h = this.d.item(c);
            this.d.removeItem(c);
            d(b, h, false);
        }
    };
    ContainerState.prototype.h = function (a) {
        if (this.f.containsKey(a)) {
            return this.f.item(a);
        }
        return -1;
    };
    ContainerState.$t = markType(ContainerState, 'ContainerState');
    return ContainerState;
}(Base));
export { ContainerState };
//# sourceMappingURL=ComponentRenderer_combined.js.map
